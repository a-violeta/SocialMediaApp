@model IEnumerable<SocialMediaApp.Models.Post>
@using System.Security.Claims

<h3>Your Feed</h3>

<div class="feed-container d-flex flex-column">
    @foreach (var post in Model)
    {
        var currentUserId = User.FindFirstValue(ClaimTypes.NameIdentifier);

        <div class="feed-post position-relative d-flex flex-row mt-3 mb-3 clickable-post"
             data-url="@Url.Action("Show", "Posts", new { id = post.Id })">

            <div class="post-pfp-container">
                <img src="~/images/Profiles/@post.User.ProfilePicture" />
            </div>

            <div class="profile-post-info d-flex flex-column text-wrap text-break">
                <div class="profile-post-username">
                    <b>@post.User.FirstName @post.User.LastName</b>
                </div>

                <div class="profile-post-content">@post.TextContent</div>

                @if (post.Images.Any() || post.Videos.Any())
                {
                    <div class="post-media d-flex">
                        @* aici se poate face preview imagini/video *@
                    </div>
                }

                <div class="post-data d-flex flex-wrap mt-2">
                    <div class="post-options d-flex me-3">
                        <div class="profile-post-likes d-flex align-items-center">
                            <i class="bi @(post.WhoLiked.Any(l => l.UserId == currentUserId) ? "bi-heart-fill text-danger" : "bi-heart") me-1"></i>
                            <span>@post.WhoLiked.Count()</span>
                        </div>

                        <div class="profile-post-comments d-flex align-items-center ms-3">
                            <i class="bi bi-chat-dots me-1"></i> @post.Comments.Count()
                        </div>
                    </div>
                    <div class="post-date d-flex ms-auto">@post.Date.ToString("g")</div>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        // face postarea "clickable"
        document.querySelectorAll(".clickable-post").forEach(p => {
            p.addEventListener("click", e => {
                const url = p.dataset.url;
                if(url) window.location.href = url;
            });
        });
    </script>
}
